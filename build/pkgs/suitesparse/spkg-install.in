cd src

# disable lto to avoid trouble when mixing different version of gcc and gfortran
CFLAGS="${CFLAGS} -fno-lto"
export CFLAGS

echo "Configuring suitesparse"
# * NSTATIC suitesparse defines some negative options like this one "NSTATIC=ON" means no static libraries.
# Hopefully these sill be normalised in the future.
# * SUITESPARSE_INCLUDEDIR_POSTFIX sets the subfolder in which to install headers.
# It default to "suitesparse" if not defined, which currently breaks dependencies.
# * SUITESPARSE_USE_FORTRAN make sure the fortran interface is built. May not be useful.
# * SUITESPARSE_ENABLE_PROJECTS semi column separated list of the desired packages. Default is
# all the packages in the suitesparse tarball.
sdh_cmake -DCMAKE_VERBOSE_MAKEFILE=ON \
          -DNSTATIC=ON \
          -DSUITESPARSE_USE_FORTRAN=ON \
          -DSUITESPARSE_INCLUDEDIR_POSTFIX="" \
          -DSUITESPARSE_ENABLE_PROJECTS="suitesparse_config;amd;camd;ccolamd;colamd;cholmod;umfpack"

sdh_make_install
